---
title: "question4"
output: html_document
---

```{r question4, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)

library(usmap)
library(ggthemes)

```

Compute the Median alcohol content for all the beers in each state
```{r}
# drop any observations without valid ABV values, group by state, and compute the median
abv_df <- merged %>% drop_na(ABV) %>% group_by(State) %>% summarize(median_abv = median(ABV)) 

# plot
abv_df %>% ggplot(aes(x=State,y=median_abv)) + geom_col() + ggtitle('Median ABV by state')

# order by median ABV
abv_df$State <- factor(abv_df$State,level=abv_df$State[order(abv_df$median_abv,decreasing=TRUE)])

# ..and replot
abv_df %>% ggplot(aes(x=State,y=median_abv)) + geom_col() + ggtitle('Median ABV by state')
```

Median Bitterness unit for all the beers in each state
```{r}
# drop any obsvervations without valid IBU values, roup by state, and compute the median
ibu_df <- merged %>% drop_na(IBU) %>% group_by(State) %>% summarize(median_ibu = median(IBU)) 

# plot
ibu_df %>% ggplot(aes(x=State,y=median_ibu)) + geom_col() + ggtitle('Median IBU by state')

# order by median IBU
ibu_df$State <- factor(ibu_df$State,level=ibu_df$State[order(ibu_df$median_ibu,decreasing=TRUE)])

# ..and replot
ibu_df %>% ggplot(aes(x=State,y=median_ibu)) + geom_col() + ggtitle('Median IBU by state')
```

```{r}
states <- map_data("state")
states_and_dc <- tibble(state = state.name) %>%
   bind_cols(tibble(abbr = state.abb)) %>% 
   bind_rows(tibble(state = "District of Columbia", abb = "DC"))
```

```{r}
abv_by_state <- abv_df %>%  group_by(State) %>% summarize(abv=first(median_abv))
abv_by_state$State <- str_trim(abv_by_state$State, "left")

colnames(abv_by_state)[1] = "abbr"
abv_by_state$abbr <- as.character(abv_by_state$abbr)

abv_by_state_tomap <- merge(abv_by_state, states_and_dc, by="abbr")

plot_usmap(regions = c("states"), data = abv_by_state_tomap,
  values = "abv", theme = theme_map(), labels = FALSE,
  label_color = "black") +
  scale_fill_continuous(name = "ABV", low="ivory", high="red2") +
  theme(legend.position="right") +
  labs(title = 'Median ABV of beers by state')
```

```{r}
ibu_by_state <- ibu_df %>%  group_by(State) %>% summarize(ibu=first(median_ibu))
ibu_by_state$State <- str_trim(ibu_by_state$State, "left")

colnames(ibu_by_state)[1] = "abbr"
ibu_by_state$abbr <- as.character(ibu_by_state$abbr)

ibu_by_state_tomap <- merge(ibu_by_state, states_and_dc, by="abbr")

plot_usmap(regions = c("states"), data = ibu_by_state_tomap,
  values = "ibu", theme = theme_map(), labels = FALSE,
  label_color = "black") +
  scale_fill_continuous(name = "ibu", low="ivory", high="red2") +
  theme(legend.position="right") +
  labs(title = 'Median ibu of beers by state')
```
























