---
title: "question9"
output: html_document
editor_options: 
  chunk_output_type: console
---

```{r question9, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
```

# Question 9
Knocking their socks off.
```{r}

# categorize beers as ipa, or other ale (still have orig columns as well as infilled)
# beers_categorized <- merged %>%
#   mutate(is_ipa = grepl("\\bIPA\\b",Style,ignore.case = TRUE)) %>%
#   mutate(is_ale = grepl("\\bale\\b",Style,ignore.case = TRUE)) %>%
#   mutate(is_american = grepl("\\bamerican\\b",Style,ignore.case = TRUE)) %>%
#   mutate(is_belgian = grepl("\\bbelgian\\b",Style,ignore.case = TRUE)) %>%
#   mutate(is_other_ale = (is_ale & !is_ipa)) 
# 
# merged$ratio <- merged$IBU/(merged$ABV*100)

style_count <- merged %>% group_by(Style) %>% summarize(n = n()) %>% arrange(desc(n))

style_count %>% filter(n > 50) %>% ggplot(aes(x=reorder(Style, desc(n)), y = n)) +
  geom_bar(stat="identity", fill = "#C8102E") +
  theme(axis.text.x = element_text(angle = 45, hjust=1)) +
  labs(title="10 Most Common Styles of Craft Brews", x="", y="Count")

q9filled <- merged %>% 
  group_by(State) %>% 
  summarize(ia_ratio = median(ratio, rm.na=TRUE)) %>% 
  summarize(medianabv = median(ABV, rm.na=TRUE)) %>%
  summarize(medianibu = median(IBU, rm.na=TRUE))
  arrange(desc(ia_ratio))
  
breweries_by_state_tomap <- merge(breweries_by_state_temp, statepop, by="abbr")

q9filled$State <- str_trim(q9filled$State, "left")
colnames(q9filled)[1] = "abbr"
q9filled$abbr <- as.character(q9filled$abbr)
 
ratio_bystate_tomap <- merge(q9filled, states_and_dc, by="abbr")

# 
library(usmap)
library(ggthemes)
# 
plot_usmap(regions = c("states"), data = ratio_bystate_tomap,
  values = "ia_ratio", theme = theme_map(), labels = FALSE,
  label_color = "black") +
  scale_fill_continuous(name = "IBU:ABV", low="ivory", high="#13294b") +
  theme(legend.position="right") +
  labs(title = 'Mean IBU:ABV ratio')



```
