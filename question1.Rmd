---
title: "question1"
output: html_document
editor_options: 
  chunk_output_type: console
---

# Question 1: How many breweries in each state?
```{r question1, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(ggplot2)
library(maps)
library(usmap)
library(ggthemes)
```

# Basic solution:
```{r}
breweries_by_state <- breweries_raw %>%  group_by(State) %>% summarize(count = n())

# simple column chart (kind of lame)
breweries_by_state %>% ggplot(aes(x=reorder(State, -count), y=count)) +
  geom_col() +
  labs(title = "Breweries by State", y="Number of Breweries")
```

# It would be a lot more interesting to have a map visualization
```{r}
# library(maps)
states <- map_data("state")

# found an empty white space in the state abbreviation data. Remove it first:
breweries_by_state$State <- str_trim(breweries_by_state$State, "left")

# add DC to embedded "state" dataset:
states_and_dc <- tibble(state = state.name) %>%
   bind_cols(tibble(abbr = state.abb)) %>% 
   bind_rows(tibble(state = "District of Columbia", abb = "DC"))

# need to match the column name for later merge:
colnames(breweries_by_state)[1] = "abbr"

# This appears to be necessary, but I'm not 100% certain why:
breweries_by_state$abbr <- as.character(breweries_by_state$abbr)

# merge three dataframes: brewery count per state, state names and abbreviations, and state population data
breweries_by_state_temp <- merge(breweries_by_state, states_and_dc, by="abbr")
breweries_by_state_tomap <- merge(breweries_by_state_temp, statepop, by="abbr")
breweries_by_state_tomap$perCapita <- breweries_by_state_tomap$count/(breweries_by_state_tomap$pop_2015/1000000)

# library(usmap)
# library(ggthemes)

### Map the total number of breweries in each state:
plot_usmap(regions = c("states"), data = breweries_by_state_tomap,
  values = "count", theme = theme_map(), labels = FALSE,
  label_color = "black") +
  scale_fill_continuous(name = "n", low="white", high="red") +
  theme(legend.position="right") +
  labs(title = 'Number of Breweries in each state')

### Map the number of breweries per capita in each state:
plot_usmap(regions = c("states"), data = breweries_by_state_tomap,
  values = "perCapita", theme = theme_map(), labels = FALSE,
  label_color = "black") +
  scale_fill_continuous(name = "n", low="white", high="blue") +
  theme(legend.position="right") +
  labs(title = 'Breweries per Capita')
```

